/***********************************
Source code for Wirbelv6, 2010-13
www.brianwevans.com
CC-BY-SA 2013
***********************************/

const byte wind[1464] = {5,5,0,0,0,0,5,5,6,8,14,23,31,35,
39,40,38,34,26,19,13,10,7,5,5,5,0,0,0,0,5,5,6,7,14,23,31,
34,38,40,38,33,26,19,12,10,7,5,5,5,0,0,0,0,5,5,6,8,13,23,
31,35,38,40,38,33,26,18,12,10,7,5,5,5,0,0,0,0,5,5,6,8,13,
23,31,35,38,40,38,33,26,19,12,10,8,5,5,5,0,0,0,0,5,5,6,8,
13,23,31,35,38,40,38,33,26,19,12,10,8,5,5,5,0,0,0,0,5,5,
7,8,12,22,31,35,38,40,38,33,26,18,12,9,8,5,5,5,0,0,0,0,5,
5,7,8,12,22,30,35,38,40,38,33,25,18,12,9,8,5,5,5,0,0,0,0,
5,5,7,8,12,22,30,34,38,40,38,33,25,18,12,9,8,5,5,5,0,0,0,
0,5,5,7,8,12,21,30,34,38,40,37,32,25,18,12,9,8,5,5,5,0,0,
0,0,5,5,7,8,12,21,30,34,37,39,37,32,25,18,12,9,8,5,5,5,0,
0,0,0,5,5,6,7,12,21,30,34,37,39,37,32,25,18,12,9,8,5,5,5,
0,0,0,0,5,5,6,7,12,21,29,34,37,39,37,32,25,18,12,9,8,5,5,
5,0,0,0,0,5,5,6,7,12,20,29,34,37,38,37,31,25,18,12,9,7,5,
5,5,0,0,0,0,5,5,6,7,11,19,29,34,37,38,36,31,24,18,12,8,7,
5,5,5,0,0,0,0,5,5,6,7,11,18,28,33,36,37,35,30,23,17,11,8,
7,5,5,5,0,0,0,0,5,5,6,7,11,19,28,33,36,37,35,30,23,17,12,
8,7,5,5,5,0,0,0,0,5,5,6,7,11,19,28,33,35,37,35,30,23,17,
12,8,7,5,5,0,0,0,0,0,5,5,6,7,10,19,28,33,35,37,34,29,23,
17,11,7,7,5,5,0,0,0,0,0,5,5,6,7,10,18,27,32,35,36,34,29,
22,17,12,7,7,5,5,0,0,0,0,0,5,5,6,7,10,18,27,32,34,36,34,
29,22,17,12,8,7,5,5,0,0,0,0,0,5,5,6,6,10,18,26,32,34,35,
34,29,22,17,12,8,7,5,5,0,0,0,0,0,5,5,6,7,10,18,26,32,34,
35,34,28,22,18,12,8,7,5,5,0,0,0,0,0,5,5,6,7,10,18,26,32,
34,35,34,28,22,18,13,8,7,5,5,5,0,0,0,0,0,5,5,7,10,18,26,
31,34,35,34,28,22,17,12,8,7,5,5,5,0,0,0,0,0,5,6,7,9,17,
25,31,34,35,34,28,22,17,12,7,7,5,5,5,0,0,0,0,0,5,6,7,9,
17,25,31,34,35,34,28,22,17,12,7,7,5,5,5,0,0,0,0,0,5,6,7,
9,17,25,31,34,34,33,27,21,16,12,7,7,5,5,5,0,0,0,0,0,5,6,
7,9,16,25,31,34,34,33,27,20,16,12,8,7,5,5,5,0,0,0,0,0,5,
6,7,9,16,24,31,34,34,33,27,21,16,12,8,7,5,5,5,0,0,0,0,0,
5,6,7,9,16,24,31,33,34,33,27,21,16,11,8,7,5,5,5,5,0,0,0,
0,5,6,7,9,15,24,30,33,34,32,27,20,16,11,7,6,6,5,5,5,0,0,
0,5,5,6,7,9,15,24,30,33,34,33,27,21,16,11,8,7,6,6,5,5,0,
5,0,0,5,6,8,9,15,24,30,33,33,32,27,21,16,11,8,7,6,6,5,5,
0,0,0,0,5,6,8,8,14,24,30,33,33,32,27,21,15,11,9,6,6,6,5,
5,0,0,0,5,5,6,8,9,14,23,30,32,33,32,26,21,15,11,8,6,6,5,
5,5,0,0,0,0,5,6,8,9,14,23,30,32,32,32,26,20,15,10,8,6,6,
5,5,5,0,0,0,0,5,6,8,8,13,23,29,32,32,31,26,20,15,9,8,6,6,
5,5,5,0,0,0,0,5,6,8,8,13,23,29,32,32,31,26,20,14,9,8,6,6,
5,5,5,0,0,0,0,5,7,8,8,12,22,29,32,32,31,26,20,14,9,8,6,6,
5,5,5,0,0,0,5,5,7,8,8,12,22,29,32,32,31,26,20,15,9,8,5,6,
5,5,5,0,0,0,0,5,7,8,8,12,22,29,32,32,31,25,20,14,9,8,6,6,
6,5,5,5,0,0,5,6,7,8,8,12,21,29,32,32,30,25,20,14,9,8,5,6,
5,5,5,5,0,0,5,5,7,8,8,12,21,28,32,32,30,25,20,13,9,7,5,6,
5,5,5,5,0,5,5,6,7,8,8,12,21,28,31,32,30,25,20,14,9,8,5,6,
6,5,5,5,0,5,5,6,7,9,9,12,21,28,31,32,30,25,20,14,10,8,5,
6,6,5,5,5,5,5,5,6,8,9,9,12,20,28,31,32,30,25,20,14,10,8,
5,6,6,5,5,5,5,5,5,6,8,9,9,11,19,28,31,31,30,24,20,14,9,7,
5,6,5,5,5,5,0,5,5,6,7,8,8,10,18,27,31,31,29,24,19,14,9,7,
5,6,5,5,5,5,5,5,5,6,8,9,9,11,19,27,30,31,29,24,19,14,9,7,
5,6,6,5,5,5,5,5,5,6,8,9,9,11,18,27,31,31,29,24,19,14,9,7,
5,7,6,6,5,5,5,5,5,6,8,9,9,11,18,26,30,31,29,24,19,14,10,
7,6,7,7,6,5,5,5,5,5,6,9,10,10,11,18,25,30,31,29,24,19,14,
10,7,6,8,7,6,6,5,5,5,5,6,9,10,10,11,17,25,29,31,29,24,19,
14,10,7,6,8,8,6,6,5,5,5,5,7,9,11,10,11,17,25,30,31,29,24,
19,14,11,8,6,8,8,7,6,5,5,5,5,7,9,11,11,12,18,25,29,31,29,
24,19,14,10,8,7,9,8,7,6,5,5,5,5,7,9,11,11,12,17,24,29,30,
28,23,18,14,10,8,7,9,8,7,6,5,5,5,5,7,9,11,11,11,17,24,28,
30,28,24,18,14,10,8,8,9,8,7,6,6,5,5,6,7,9,11,11,11,17,24,
28,30,28,23,19,14,10,8,8,9,8,7,6,5,6,5,5,8,9,11,11,11,17,
24,28,29,28,23,18,14,10,8,7,9,8,7,6,5,5,5,5,7,9,11,12,12,
16,24,28,29,28,22,18,13,9,8,7,9,8,7,6,5,5,5,5,7,9,12,12,
12,16,24,28,29,28,22,18,14,9,8,8,9};

// each fan connected to PWM channel
const byte fan1 = 3;  
const byte fan2 = 5;
const byte fan3 = 6;
const byte fan4 = 9;
const byte fan5 = 10;
const byte fan6 = 11;

// status LED on pin13
const byte stat = 13;

byte oldVal1 = 0;
byte oldVal2 = 0;
byte oldVal3 = 0;
byte oldVal4 = 0;
byte oldVal5 = 0;
byte oldVal6 = 0;

byte a = 0;
byte b = 1;
byte c = 2;
byte d = 3;
byte e = 4;
byte f = 5;

float stepVal;

void setup() {
  pinMode(stat, OUTPUT);

  // LED flashes to warn that the fans are starting up
  for(int i=0; i<=4; i++){
    digitalWrite(stat, HIGH);
    delay(500);
    digitalWrite(stat, LOW);
    delay(500);
  }
}

void loop() {
    for(int j=0; j<10; j++){
      
      // FAN 1
      if(wind[a] > oldVal1){
        stepVal = (wind[a] - oldVal1) / 10;
        analogWrite(fan1, (int((j+1)*stepVal))+oldVal1);
      }else{                         
        stepVal = (oldVal1 - wind[a]) / 10;   
        analogWrite(fan1, oldVal1-(int((j+1)*stepVal)));
      }
      
      // FAN 2
      if(wind[b] > oldVal2){
        stepVal = (wind[b] - oldVal2) / 10;
        analogWrite(fan2, (int((j+1)*stepVal))+oldVal2);
      }else{                         
        stepVal = (oldVal2 - wind[b]) / 10;   
        analogWrite(fan2, oldVal2-(int((j+1)*stepVal)));
      }
      
      // FAN 3
      if(wind[c] > oldVal3){
        stepVal = (wind[c] - oldVal3) / 10;
        analogWrite(fan3, (int((j+1)*stepVal))+oldVal3);
      }else{                         
        stepVal = (oldVal3 - wind[c]) / 10;   
        analogWrite(fan3, oldVal3-(int((j+1)*stepVal)));
      }
      
      // FAN 4
      if(wind[d] > oldVal4){
        stepVal = (wind[d] - oldVal4) / 10;
        analogWrite(fan4, (int((j+1)*stepVal))+oldVal4);
      }else{                         
        stepVal = (oldVal4 - wind[d]) / 10;   
        analogWrite(fan4, oldVal4-(int((j+1)*stepVal)));
      }
      
      // FAN 5
      if(wind[e] > oldVal5){
        stepVal = (wind[e] - oldVal5) / 10;
        analogWrite(fan5, (int((j+1)*stepVal))+oldVal5);
      }else{                         
        stepVal = (oldVal5 - wind[e]) / 10;   
        analogWrite(fan5, oldVal5-(int((j+1)*stepVal)));
      }
      
      // FAN 6
      if(wind[f] > oldVal6){
        stepVal = (wind[f] - oldVal6) / 10;
        analogWrite(fan6, (int((j+1)*stepVal))+oldVal6);
      }else{                         
        stepVal = (oldVal6 - wind[f]) / 10;   
        analogWrite(fan6, oldVal6-(int((j+1)*stepVal)));
      }
      
      delay(100);
      digitalWrite(stat, HIGH);  
    }
    
    oldVal1 = wind[a];               
    oldVal2 = wind[b];
    oldVal3 = wind[c];
    oldVal4 = wind[d];
    oldVal5 = wind[e];
    oldVal6 = wind[f];
    
    a++;
    b++;
    c++;
    d++;
    e++;
    f++;
    
    if(a > 1464) a = 0;
    if(b > 1464) b = 0;
    if(c > 1464) c = 0;
    if(d > 1464) d = 0;
    if(e > 1464) e = 0;
    if(f > 1464) f = 0;
    
    digitalWrite(stat, LOW);
}

